<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Music Search</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding" #content (ionScroll)="onScroll($event)">
  <div class="content-container">
    <!-- Results Display -->
    <div class="search-sections">
      <!-- Artist Section -->
      <div class="search-section artist-section">
        <ion-searchbar 
          [(ngModel)]="artistSearchTerm"
          (ionInput)="handleArtistSearch($event)"
          (keyup.enter)="handleArtistSearch($event)"
          (ionClear)="handleClear('artist')"
          placeholder="Search for an artist..."
          [debounce]="400">
        </ion-searchbar>
        @if (isArtistLoading) {
          <ion-spinner></ion-spinner>
        }
        @if (artistData) {
          <ion-card>
            <!-- Artist header with image and name -->
            <ion-card-header>
              <div class="artist-header">
                <ion-thumbnail>
                  <ion-img [src]="artistData.image[2]['#text']" [alt]="artistData.name"></ion-img>
                </ion-thumbnail>
                <ion-card-title>{{ artistData.name }}</ion-card-title>
              </div>
            </ion-card-header>

            <!-- Artist statistics and details -->
            <ion-card-content>
              <div class="stats-container">
                <!-- Listener count display -->
                <ion-chip>
                  <ion-icon name="headset-outline"></ion-icon>
                  <ion-label>{{ Number(artistData.stats.listeners).toLocaleString() }} listeners</ion-label>
                </ion-chip>
                <!-- Play count display -->
                <ion-chip>
                  <ion-icon name="play-outline"></ion-icon>
                  <ion-label>{{ Number(artistData.stats.playcount).toLocaleString() }} plays</ion-label>
                </ion-chip>
              </div>

              <!-- Artist biography with HTML cleanup -->
              @if (artistData.bio?.content) {
                <p class="bio">{{ cleanBioText(artistData.bio.content) }}</p>
              }

              <!-- Top tracks section -->
              @if (artistData.topTracks?.length > 0) {
                <div class="top-tracks">
                  <h3>Top Tracks</h3>
                  <ion-list>
                    @for (track of artistData.topTracks; track track.name) {
                      <ion-item>
                        <ion-label>{{ track.name }}</ion-label>
                      </ion-item>
                    }
                  </ion-list>
                </div>
              }
            </ion-card-content>
          </ion-card>
        }
      </div>

      <!-- Track Section -->
      <div class="search-section track-section">
        <ion-searchbar 
          [(ngModel)]="trackSearchTerm"
          (ionInput)="handleTrackSearch($event)"
          (keyup.enter)="handleTrackSearch($event)"
          (ionClear)="handleClear('track')"
          placeholder="Search for a track..."
          [debounce]="400">
        </ion-searchbar>
        @if (isTrackLoading) {
          <ion-spinner></ion-spinner>
        }
        @if (trackData.length > 0) {
          <ion-list>
            @for (track of trackData; track $index) {
              <ion-item>
                <ion-thumbnail slot="start">
                  <ion-img [src]="track.image[1]['#text'] || 'assets/images/default-album.png'" [alt]="track.name"></ion-img>
                </ion-thumbnail>
                <ion-label>
                  <h2>{{ track.name }}</h2>
                  <p>{{ track.artist }}</p>
                  <p>{{ (track.listeners).toLocaleString() }} listeners</p>
                </ion-label>
              </ion-item>
            }
          </ion-list>
        }
      </div>

      <!-- Album Section -->
      <div class="search-section album-section">
        <ion-searchbar 
          [(ngModel)]="albumSearchTerm"
          (ionInput)="handleAlbumSearch($event)"
          (keyup.enter)="handleAlbumSearch($event)"
          (ionClear)="handleClear('album')"
          placeholder="Search for an album..."
          [debounce]="400">
        </ion-searchbar>
        @if (isAlbumLoading) {
          <ion-spinner></ion-spinner>
        }
        @if (albumData.length > 0) {
          <ion-list class="album-grid">
            @for (album of albumData; track $index) {
              <ion-card class="album-card">
                <img [src]="album.image[2]['#text'] || 'assets/images/default-album.png'" [alt]="album.name">
                <ion-card-header>
                  <ion-card-title>{{ album.name }}</ion-card-title>
                  <ion-card-subtitle>{{ album.artist }}</ion-card-subtitle>
                </ion-card-header>
              </ion-card>
            }
          </ion-list>
        }
      </div>
    </div>

    <!-- Search History Section -->
    @if (searchHistory.length > 0) {
      <div class="search-history">
        <div class="history-header">
          <h2>Recent Searches</h2>
          <ion-button (click)="clearSearchHistory()" fill="clear" size="small">
            Clear History
          </ion-button>
        </div>
        <ion-list>
          @for (search of searchHistory; track search.term) {
            <ion-item>
              <ion-label>{{ search.term }}</ion-label>
              <ion-badge slot="end">{{ search.type }}</ion-badge>
            </ion-item>
          }
        </ion-list>
      </div>
    }
  </div>
  
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="showScrollButton">
    <ion-fab-button size="small" (click)="scrollToTop()">
      <ion-icon name="arrow-up"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
